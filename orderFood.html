<!DOCTYPE html>
<html>
<head>
  <title>点餐</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <meta name="description" content=" ">

  <link rel="stylesheet" href="src/css/weui.min.css">
  <link rel="stylesheet" href="dist/css/jquery-weui.css">
  <link rel="stylesheet" href="dist/css/fonts/iconfont.css">
  <link rel="stylesheet" href="dist/css/canxiaoer.css">

</head>

<body ontouchstart>
  <div class="backBar">
    <a href="javascript:history.back()" class="back">
      <i class="text-icon icon-shop-back"></i>
    </a>
    <p class="title">点餐</p>
  </div>
  <div class="orderFood">
    <nav>
    </nav>

    <div class="con">

    </div>
  </div>
  <div class="cartGrop">
    <div class="menuList">
      <div class="menuPanel">
        <div class="bg"></div>
        <div class="menuCont">
          <div class="menuHd">购物车 <span class="fr"><i class="icon-shop icon-shop-delete"></i>清空购物车</span></div>
          <dl>
            <dt><div class="title">欢聚一趟套餐</div></dt>
            <dd>
              <div class="price">
                <span>299</span>
              </div>

              <div class="btnGroup">
                <i class="icon-shop icon-shop-jian"></i>
                <span>0</span>
                <i class="icon-shop icon-shop-jia"></i>
              </div>
            </dd>
          </dl>
          <dl>
            <dt><div class="title">欢聚一趟套餐</div></dt>
            <dd>
              <div class="price">
                <span>299</span>
              </div>

              <div class="btnGroup">
                <i class="icon-shop icon-shop-jian"></i>
                <span>0</span>
                <i class="icon-shop icon-shop-jia"></i>
              </div>
            </dd>
          </dl>
          <dl>
            <dt><div class="title">欢聚一趟套餐</div></dt>
            <dd>
              <div class="price">
                <span>299</span>
              </div>

              <div class="btnGroup">
                <i class="icon-shop icon-shop-jian"></i>
                <span>0</span>
                <i class="icon-shop icon-shop-jia"></i>
              </div>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="con">
      <div class="cart"> <div class="weui-badge">0</div> </div>
      <div class="totalPrice"><span>0</span></div>
      <div class="gotoPay"><a href="reserveAffirm.html">去结算</a></div>

    </div>
  </div>

<script src="dist/js/jquery-2.1.4.js"></script>
<script src="dist/js/fastclick.js"></script>
<script>
$(function() {
  FastClick.attach(document.body);
});
</script>
<script src="dist/js/jquery-weui.js"></script>
<script src="src/js/canxiaoer.js"></script>
<script>
  $(function () {


      var jia = $('.icon-shop-jia'),
          jian = $('.icon-shop-jian'),
          totalPrice = parseFloat( $('.totalPrice span').text() );
//      console.log(totalPrice);

//      jia click
      jia.click(function () {
          var num = $(this).prev().text(); //单个菜品份数
          var all = parseInt(num) + 1;
          $(this).prev().text(all);  //单个菜品总数

          var price = parseFloat( $(this).parent().siblings('.price').children().text() ); //单价
          $('.totalPrice span').text(  totalPrice += price ); // 总价

          var count = parseInt( $('.weui-badge').text() );  //计数
          $('.weui-badge').text( count += 1 );

          //console.log(price);

          //添加本地存储
          var title = $(this).parent().siblings('.title').text();//菜品名称
          var singlePrice = num * price;//单个菜品总价

          var ls = localStorage;
          ls = {
              title : title,
                  singlePrice:singlePrice,
                  num : num,
                  cont:count
          };
          console.log(ls.title   +ls.singlePrice +'<br>' + ls.num + '<br>'+ ls.count)
      });

//      jian
      jian.click(function () {
          var num = $(this).next().text();
          var all = parseInt(num) - 1;
          if( num <= 0 ){
              return false
          }
          $(this).next().text(all);  //菜品份数相加

          var price = parseFloat( $(this).parent().siblings('.price').children().text() ); //单价
          $('.totalPrice span').text(  totalPrice -= price ); // 总价

          var count = parseInt( $('.weui-badge').text() );  //计数
          $('.weui-badge').text( count -= 1 );

//          console.log(price);
      });
  });



//  获取所有菜品类型
  var dishesCate = 'http://119.23.135.79:8001/api/ServiceForApp/GetAllDTID?Key=CanXiao2App';

  GetData(dishesCate, {}, function (json) {
      if( json.IsResult){
          $.each(json.Data, function (i,item) {
              var dishesCateName = item.Name;
              //左侧菜品分类
              $('.orderFood nav').append(
                  '<li><a href="#cate-'+ i +'">' + dishesCateName + '</a></li>'
              );
          });

          var x = json.Data.length;
//          var getDishes = 'http://119.23.135.79:8001/api/ServiceForApp/GetDishesByValue?Key=CanXiao2App&Value=' + x
//          console.log(x);

          var getDishes = 'http://119.23.135.79:8001/api/ServiceForApp/GetDishesByValue?Key=CanXiao2App&Value=';

          $.each(json.Data, function (i,item) {
              var getDishes = 'http://119.23.135.79:8001/api/ServiceForApp/GetDishesByValue?Key=CanXiao2App&Value=' + (i+1);
              /*console.log(
                  getDishes  //接口根据菜品分类值查询
              )*/
              $('.orderFood .con').append(
                  '<div id="cate-'+i+'">'+
                  /*'<dl>'+
                  '<dt><img src="'+ pic +'" alt=""></dt>'+
                  '<dd>'+
                  '<div class="title">'+ dishesName +'</div>'+
                  //                              '<div class="sales">月销 <span>'+ 40 +'</span></div>'+
                  '<div class="price">'+
                  '<span>' + price + '</span>'+
                  '</div>'+
                  '<div class="btnGroup">'+
                  '<i class="icon-shop icon-shop-jian"></i>'+
                  '<span>'+ 0 +'</span>'+
                  '<i class="icon-shop icon-shop-jia"></i>'+
                  '</div>'+
                  '</dd>'+
                  '</dl>'+*/
                  '</div>'
              );

              GetData(getDishes, {}, function (json) {
                  if( json.IsResult ){
                      $.each(json.Data,function (i,item) {
                          var pic = item.ImagePath;
                            ( pic == null ) ? $('.orderFood .con dl dt img').attr('src', pic) : $('.orderFood .con dl dt img').attr('src', 'img/upload/n-a1.jpg');  //没图片就使用默认图片
                          var dishesName = item.Name;
                          var price = item.Price;
//                        console.log(dishesName);

                          $('.orderFood .con').append(
                              '<div id="cate-'+i+'">'+
                              '<dl>'+
                              '<dt><img src="'+ pic +'" alt=""></dt>'+
                              '<dd>'+
                              '<div class="title">'+ dishesName +'</div>'+
                              //                              '<div class="sales">月销 <span>'+ 40 +'</span></div>'+
                              '<div class="price">'+
                              '<span>' + price + '</span>'+
                              '</div>'+
                              '<div class="btnGroup">'+
                              '<i class="icon-shop icon-shop-jian"></i>'+
                              '<span>'+ 0 +'</span>'+
                              '<i class="icon-shop icon-shop-jia"></i>'+
                              '</div>'+
                              '</dd>'+
                              '</dl>'+
                              '</div>'
                          );


//                          ( pic == null ) ? alert(1) : alert(2);  //没图片就使用默认图片

                      })



                  }

              });



//              console.log(i+1 );// 123456

//              var dishesCateName = item.Name;
//              //左侧菜品分类
//              $('.orderFood .con').append(
//                  '<div id="cate-'+x+'">'+
//                  '<dl>'+
//                  '<dt><img src="img/upload/n-a1.jpg" alt=""></dt>'+
//                  '<dd>'+
//                  '<div class="title">'+ 欢聚一趟套餐1 +'</div>'+
//                  '<div class="sales">月销 <span>'+ 40 +'</span></div>'+
//                  '<div class="price">'+
//                  '<span>' + 10 + '</span>'+
//                  '</div>'+
//                  '<div class="btnGroup">'+
//                  '<i class="icon-shop icon-shop-jian"></i>'+
//                  '<span>'+ 0 +'</span>'+
//                  '<i class="icon-shop icon-shop-jia"></i>'+
//                  '</div>'+
//                  '</dd>'+
//                  '</dl>'+
//                  '</div>'
//              );
          });

      }

      //设置菜单选中状态
      var cateOn = $('.orderFood nav li');
      cateOn.first().addClass('on');
      cateOn.click(function () {
          $(this).addClass('on').siblings().removeClass('on');
      });


//      var x = json.Data.length;
//      $('.orderFood .con').append('1')
      /*for( var x = 0 ; x < json.Data.length; x++){
          console.log(x)

          //右侧菜品
          $('.orderFood .con').append(

              '<div id="cate-'+x+'">'+
              '<dl>'+
              '<dt><img src="img/upload/n-a1.jpg" alt=""></dt>'+
              '<dd>'+
              '<div class="title">'+ 欢聚一趟套餐1 +'</div>'+
              '<div class="sales">月销 <span>'+ 40 +'</span></div>'+
              '<div class="price">'+
              '<span>' + 10 + '</span>'+
              '</div>'+
              '<div class="btnGroup">'+
              '<i class="icon-shop icon-shop-jian"></i>'+
              '<span>'+ 0 +'</span>'+
              '<i class="icon-shop icon-shop-jia"></i>'+
              '</div>'+
              '</dd>'+
              '</dl>'+
              '</div>'
          );
//                console.log(json.Data.length)

      }*/





//      console.log(json.Data.length);

      //  菜品分类选中效果

  });



  var apiUrl = 'http://119.23.135.79:8001/api/ServiceForApp/YDOrderDishes?Key=CanXiao2App';
  var prams = {
      "UID": "string",
      "DAID": "string",
      "DaName": "string",
      "BIID": "string",
      "PersonNum": 0,
      "DtNum": 0,
      "Remarks": "string",
      "ReserveTime": "2017-09-13T08:51:35.464Z",
      "PaySource": "string",
      "LinkMan": "string",
      "LinkManSex": 0,
      "LinkPhone": "string",
      "MealCoin": 0,
      "Dishes": [
          {
              "DishesID": "string",
              "Name": "string",
              "Num": 0,
              "SinglePrice": 0,
              "Discount": 0,
              "Remarks": "string",
              "IsDishesSet": 0,
              "DishesSet": [
                  {
                      "DishesID": "string",
                      "Name": "string",
                      "Num": 0,
                      "Remarks": "string"
                  }
              ]
          }
      ]
  };
/*  GetData(apiUrl, prams, function () {
      
  });*/
</script>
</body>

</html>
