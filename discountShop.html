<!DOCTYPE html>
<html>
<head>
<title>折扣</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<meta name="description" content=" ">

<link rel="stylesheet" href="src/css/weui.min.css">
<link rel="stylesheet" href="dist/css/jquery-weui.css">
<link rel="stylesheet" href="dist/css/fonts/iconfont.css">
<link rel="stylesheet" href="dist/css/canxiaoer.css">

</head>

<body ontouchstart>
  <header class="index-header">
    <div class="search-icon"><i class="weui-icon-search"></i></div>
    <div class="title">折扣</div>
    <div class="talk"><i class="icon-shop icon-shop-talk"></i></div>
  </header>

  <div class="proFilter pt22">
    <div class="nav">
      <div class="nav-container">
        <div class="navbar">
          <a href="javascript:;">全部</a>
          <a href="javascript:;">附近</a>
          <a href="javascript:;">智能排序</a>
        </div>
        <div class="bd">
          <section>
            <ul class="dropList">
              <!-- <li><a href="javascript:;"><span>全部</span><span>22222</span></a></li>
              <li><a href="javascript:;"><span>全部1</span><span>22222</span></a></li>
              <li><a href="javascript:;"><span>全部2</span><span>22222</span></a></li>
              <li><a href="javascript:;"><span>全部3</span><span>22222</span></a></li>
              <li><a href="javascript:;"><span>全部4</span><span>22222</span></a></li> -->
            </ul>
          </section>
          <section>
            <div class="tab">
              <div class="tab-hd">
                <a href="javascript:;">商圈</a>
                <a href="javascript:;">地铁</a>
              </div>
              <div class="tab-bd">
                <ul>
                  <div class="scroller">
                    <div class="dropList">
                      <li><a href="javascript:;"><span>武侯区</span><span>111</span></a></li>
                      <li><a href="javascript:;"><span>青羊区</span><span>222</span></a></li>

                    </div>
                    <div class="subRegion">
                      <li><a href="javascript:;"><span>科华北路</span><span>11</span></a></li>
                      <li><a href="javascript:;"><span>桐梓林</span><span>22</span></a></li>
                    </div>
                  </div>
                </ul>
                <ul>
                  <div class="scroller ">
                    <div class="dropList ">
                      <li><a href="javascript:;"><span>1号线</span><span>eee</span></a></li>
                      <li><a href="javascript:;"><span>2号线</span><span>ff</span></a></li>
                    </div>
                    <div class="subRegion">
                      <li><a href="javascript:;"><span>测试a</span><span>ggg</span></a></li>
                      <li><a href="javascript:;"><span>测试b</span><span>xxx</span></a></li>
                    </div>
                  </div>
                </ul>
              </div>
            </div>
          </section>
          <section>
            <ul class="dropList">
              <li><a href="javascript:;">智能排序</a></li>
              <li><a href="javascript:;">离我最近</a></li>
              <li><a href="javascript:;">好评优先</a></li>
              <li><a href="javascript:;">人气最高</a></li>
            </ul>
          </section>
        </div>
        <div class="nav-bg"></div>
      </div>
    </div>
    <div class="weui-panel weui-panel_access">
      <div class="weui-panel__bd">

      </div>
    </div>
  </div>

  <div class="footNav">
    <div class="weui-grids">
      <a href="index.html" class="weui-grid js_grid">
        <i class="iconfont icon-all"></i>
        <p class="weui-grid__label">首页</p>
      </a>
      <a href="recommendShop.html" class="weui-grid js_grid">
        <i class="iconfont icon-dianpu"></i>
        <p class="weui-grid__label">荐店</p>
      </a>
      <a href="discountShop.html" class="weui-grid js_grid  on">
        <i class="iconfont icon-zhekou"></i>
        <p class="weui-grid__label">折扣</p>
      </a>
      <a href="member/index.html" class="weui-grid js_grid">
        <i class="iconfont icon-wode"></i>
        <p class="weui-grid__label">我的</p>
      </a>
    </div>
  </div>




<script src="dist/js/jquery-2.1.4.js"></script>
<script src="dist/js/fastclick.js"></script>
<script>
  $(function() {
    FastClick.attach(document.body);
  });
</script>
<script src="dist/js/jquery-weui.js"></script>
<script src="dist/js/swiper.min.js"></script>
<script src="src/js/canxiaoer.js"></script>

<script>
  //获取餐厅类型
  var diningRoomType = 'http://119.23.135.79:8001/api/ServiceForApp/GetDiningTyeList?Key=CanXiao2App';
  GetData(diningRoomType, {}, function(json){
    if( json.IsResult ){
      $.each(json.Data, function(i, item) {
         var name = item.Name;
         var value = item.Value;

         var pic = 'http://119.23.135.79:8002' + item.ImagePath;

         /*$('.index-col1 .weui-grids').append(
            // '<a href="serch.html?typeid='+value+'"id="'+value+'" class="weui-grid js_grid">'+
            '<a href="search.html?typeid='+value+'"class="weui-grid js_grid">'+
              '<div class="weui-grid__icon">'+
                '<img src="' + pic +'" alt="">'+
              '</div>'+
              '<p class="weui-grid__label">'+name+'</p>'+
            '</a>'
          )*/


         //添加餐厅类型到筛选菜单
         $('.nav .bd section:first-of-type .dropList').append(
              '<li><a href="javascript:;" id="'+ value +'"><span>'+ name +'</span><span></span></a></li>'
          )



      });
    }
  })
  
  
  

      $hd_a = $('.nav .navbar a');
      $bd_s = $('.nav .bd section');

      $tab_hd_a = $('.nav .tab .tab-hd a');
      $tab_bd_ul = $('.nav .tab .tab-bd ul');
      //  头部菜单

       $hd_a.click( function() {
          /*$('.nav .nav-container').addClass('active');
          $(this).toggleClass('on').siblings().removeClass('on');
          $('.nav .nav-bg').show();
          $('.nav .bd').show();*/
           $('.nav .nav-container').addClass('active');
          $(this).addClass('on').siblings().removeClass('on');
          $('.nav .nav-bg').show();
          $('.nav .bd').show();


          var index = $hd_a.index(this);
          $bd_s.eq(index).show().siblings().hide();

      });


// 点击灰色背景关闭
      $('.nav .nav-bg').click(function(){
          $('.nav-container.active').removeClass('active');
          $('.nav-container .bd').hide();
          $('.navbar a.on').removeClass('on');
          $(this).hide();
      })


      $tab_hd_a.first().addClass('on');
      $tab_bd_ul.first().show();
      $tab_hd_a.on('click',function(){
          $(this).addClass('on').siblings().removeClass('on');
          var index  = $tab_hd_a.index(this);
          $tab_bd_ul.eq(index).show().siblings().hide();
      });
      // 内容筛选
      $('.dropList li:first-of-type').addClass('on');
      $('.dropList li').on('click', function() {
          $(this).addClass('on').siblings().removeClass('on');
          $('.navbar a.on').removeClass('on'); //取消头部选中效果
      });



      $('.scroller .dropList li').on('click',function () {
          $(this).parent().addClass('active').siblings().addClass('active');
          //alert(1)
      });
      //获取选中得值
      
      //        附近
      $('.nav .subRegion a ').on('click',function () {
          var $a2 =      $(this).children().first().text();
//            var $a2 =      $(this).children().first().text();
          $('.nav .navbar  a:nth-child(2)').html($a2);
          //关闭内容区域
          $('.nav .nav-container').removeClass('active');
          $('.nav .nav-bg').hide();
          $('.nav .bd').hide();
      });
      //        智能排序
      $('.nav .bd section:last-child a ').on('click',function () {
          var $a3 =      $(this).text();
          $('.nav .navbar  a:last-child').html($a3);
          //关闭内容区域
          $('.nav .nav-container').removeClass('active');
          $('.nav .nav-bg').hide();
          $('.nav .bd').hide();
      });

      //关闭列表
      /*var shop_pic = $('.weui-media-box__thumb').attr('src'),
          title = $('.weui-media-box__title').html();*/

//      alert(title);

      // 获取荐店 商家列表
      var indexUrl = 'http://119.23.135.79:8001/api/ServiceForApp/GetBusinessInfoListByCategory?Key=CanXiao2App&Category=1';
      GetData(indexUrl, {}, function (json) {
          if (json.IsResult)
          {
              $.each(json.Data, function (i,item)
              {
                  var shopName = item.Name,
                      dtid = item.DTID,
                      pic = '',
                      score = item.Score,
                      renjun = item.PerPersonCost,
                      shopid = item.ID;
                     /* lat2 = item.Latitude,
                      lng2 = item.Longitude;*/

//获取距离
                 /* var geolocation = new BMap.Geolocation();
                  geolocation.getCurrentPosition(function (pos) {
                      var lng1 = pos.point.lng;//当前经度
                       var lat1 = pos.point.lat;//当前纬度
                      console.log(lng2 + '<br>' + lat2);
                  });*/


                  var url = 'shopDetails.html?shopid='+shopid;
                  $('.weui-panel__bd').append(
                      '<a href='+url+' class="weui-media-box weui-media-box_appmsg">'+
                      '<div class="weui-media-box__hd">'+
                      '<img class="weui-media-box__thumb" src="img/upload/a1.jpg">' +
                      '</div>'+
                      '<div class="weui-media-box__bd">'+
                      '<div class="dis-f">'+
                      '<h4 class="weui-media-box__title">'+
                      shopName +
                      '<span class="icon-mark icon-mark-yuding"></span>'+
                      '<span class="icon-mark icon-mark-diancan"></span>'+
//                      '<span class="icon-mark icon-mark-waimai"></span>'+
                      '<span class="icon-mark icon-mark-taocan"></span>'+
                      '</h4>'+
                      '</div>'+
                      '<div class="comment">'+
                      '<span class="star"></span>'+
                      '<span>人均:￥'+renjun+'</span>'+
                      '</div>'+
                      '<div class="intro">'+
                      '<span>'+'火锅'+'</span><span class="fr">'+'复城国际广场 1.5km'+'</span>'+
                      '</div>'+
                      '</div>'+
                      '</a>'
                  );
                   //预点外套  
                  if(item.IsPreOrder !== 1){ $('.icon-mark-yuding').hide(); }
                  if(item.IsOrdered !== 1){ $('.icon-mark-diancan').hide(); }
//                  if(item.IsTakeOut == 1){ $('.icon-mark-waimai').hide(); }
                  if(item.IsMealSet !== 1){ $('.icon-mark-taocan').hide(); }
                  

                  //评分
                  var star = $('.star');
                  star.addClass('star-' + score);

                  // 选择餐厅类型
                  var diningRoomType = $('.nav .bd section:first a');
                  diningRoomType.unbind('click').click(function() {
                    $('.weui-panel__bd a').remove();//点击过后删除之前的商家列表
                    var id = $(this).attr('id');
                  // alert(id)
                    var dtidShopList = 'http://119.23.135.79:8001/api/ServiceForApp/GetBusinessInfoListByDTID?Key=CanXiao2App&DTID=' + id;

                        GetData(dtidShopList, {}, function (json) {
                          if (json.IsResult)
                          {
                              $.each(json.Data, function (i,item)
                              {
                                  var shopName = item.Name,
                                      pic = '',
                                      score = item.Score,
                                      renjun = item.PerPersonCost,
                                      shopid = item.ID;
                                  
                                  $('.weui-panel__bd').append(
                                      '<a href='+url+' class="weui-media-box weui-media-box_appmsg">'+
                                      '<div class="weui-media-box__hd">'+
                                      '<img class="weui-media-box__thumb" src="img/upload/a1.jpg">' +
                                      '</div>'+
                                      '<div class="weui-media-box__bd">'+
                                      '<div class="dis-f">'+
                                      '<h4 class="weui-media-box__title">'+
                                      shopName +
                                      '<span class="icon-mark icon-mark-yuding"></span>'+
                                      '<span class="icon-mark icon-mark-diancan"></span>'+
                //                      '<span class="icon-mark icon-mark-waimai"></span>'+
                                      '<span class="icon-mark icon-mark-taocan"></span>'+
                                      '</h4>'+
                                      '</div>'+
                                      '<div class="comment">'+
                                      '<span class="star"></span>'+
                                      '<span>人均:￥'+renjun+'</span>'+
                                      '</div>'+
                                      '<div class="intro">'+
                                      '<span>'+'火锅'+'</span><span class="fr">'+'复城国际广场 1.5km'+'</span>'+
                                      '</div>'+
                                      '</div>'+
                                      '</a>'
                                  );
                                  if(item.IsPreOrder !== 1){ $('.icon-mark-yuding').hide(); }
                                  if(item.IsOrdered !== 1){ $('.icon-mark-diancan').hide(); }
                //                  if(item.IsTakeOut == 1){ $('.icon-mark-waimai').hide(); }
                                  if(item.IsMealSet !== 1){ $('.icon-mark-taocan').hide(); }
                                  var star = $('.star');
                                  star.addClass('star-' + score);

                              })
                          }
                        }) //dtidShopList

                        $(this).parent().addClass('on').siblings().removeClass('on');
                        var $a1 =      $(this).children().first().text();
                        $('.nav .navbar  a:first').html($a1);
                        //关闭内容区域
                        $('.nav .nav-container').removeClass('active');
                        $('.nav .nav-bg').hide();
                        $('.nav .bd').hide();
                        $('.nav .navbar a').removeClass('on');
                        // alert(id)

                  })



                  //        全部
                  /*$('.nav .bd section:first a ').on('click',function () {
                      var $a1 =      $(this).children().first().text();
                      $(this).parent().addClass('on').siblings().removeClass('on');
                      $('.nav .navbar  a:first').html($a1);
                      //关闭内容区域
                      // $('.nav .navbar a').removeClass('on');
                      $('.nav .nav-container').removeClass('active');
                      $('.nav .nav-bg').hide();
                      $('.nav .bd').hide();
                  });*/
                  
              });// end 选择餐厅类型
          }
      });// end 获取商家列表

  </script>
  

</body>

</html>
